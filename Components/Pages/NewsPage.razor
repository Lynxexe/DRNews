@using System.Collections.Generic;
@using System.Reflection.Metadata;
@using System.Xml.Linq;
@using System.Windows.Input
@page "/news"
<style>
    .news-container {
        display: flex;
        align-items: center;
        position: relative; /* Set position relative for the parent container */
        padding: 10px;
    }

    .image-container {
        position: absolute; /* Position the image container absolutely */
        top: 50%; /* Move the image container to the vertical center */
        left: 20px; /* Adjust the left offset as needed */
        transform: translateY(-50%); /* Center the image container vertically */
        width: 100px; /* Increase the width to make the circle bigger */
        height: 100px; /* Increase the height to make the circle bigger */
    }

    .news-image {
        width: 100%; /* Set the width of the image to fill the container */
        height: 100%; /* Set the height of the image to fill the container */
        object-fit: cover; /* Ensure images maintain aspect ratio and cover the space */
        border-radius: 50%; /* Create a circular shape */
    }

    .content-container {
        margin-left: 140px; /* Adjust the left margin to create space for the larger image */
    }

    .content {
        position: absolute; /* Position the content container absolutely */
        top: 50%; /* Move the content container to the vertical center */
        left: 0; /* Align the content container to the left */
        transform: translateY(-50%); /* Center the content container vertically */
    }
</style>


@if (newsItems == null)
{
    <p>Loading...</p>
}
else
{
        @foreach (var item in newsItems)
        {
        <div class="news-container">
            @if (!string.IsNullOrEmpty(item.Image))
            {
                <div class="image-container">
                    <img src="@item.Image" alt="News Image" class="news-image" />
                </div>
            }
            else
            {
                <div class="image-container">
                    <img src="images/newsimage.jpg" alt="News Image" class="news-image" />
                </div>
            }
            <div class="content-container">
                <h4>@item.Title</h4>
                <p class="news-date">@item.Date</p>
            </div>
        </div>
        }
}

@code {
    private List<NewsItem> newsItems;
    public ICommand RefreshCommand { get; }


    protected override async Task OnInitializedAsync()
    {
        await LoadNewsAsync();
    }

    private async Task LoadNewsAsync()
    {
        var httpClient = new HttpClient();
        var feedUrls = new List<string>
        {
            "https://www.dr.dk/nyheder/service/feeds/senestenyt",
            "https://www.dr.dk/nyheder/service/feeds/indland",
            "https://www.dr.dk/nyheder/service/feeds/udland",
            // Add other feed URLs here...
        };

        var tasks = feedUrls.Select(url => httpClient.GetStringAsync(url));
        var results = await Task.WhenAll(tasks);

        var items = new List<NewsItem>();
        XNamespace mediaNameSpace = "http://search.yahoo.com/mrss/";
        foreach (var result in results)
        {
            var document = XDocument.Parse(result);
            Console.WriteLine(result);
            var news = document.Descendants("item")
                               .Select(item => new NewsItem
                               {
                                   Title = (string)item.Element("title"),
                                   Link = (string)item.Element("link"),
                                   Date = (string)item.Element("pubDate"),
                                       Image = (string)item.Descendants(mediaNameSpace + "content").FirstOrDefault()?.Attribute("url")?.Value
                               });
            items.AddRange(news);
        }


        newsItems = items.Select(item =>
    {
        // Parse the date string into a DateTime object
        DateTime newsDate = DateTime.Parse(item.Date);
        // Calculate the time difference
        TimeSpan difference = DateTime.UtcNow - newsDate;
        string formattedDate;
        if (difference.TotalSeconds >= 0)
        {
            if (difference.TotalDays >= 1)
            {
                // If the difference is more than or equal to 1 day, display it in days
                formattedDate = $"{(int)difference.TotalDays} days ago";
            }
            else if (difference.TotalHours >= 1)
            {
                // If the difference is less than 1 day but more than or equal to 1 hour, display it in hours
                formattedDate = $"{(int)difference.TotalHours} hours ago";
            }
            else if (difference.TotalMinutes >= 1)
            {
                // If the difference is less than 1 hour but more than or equal to 1 minute, display it in minutes
                formattedDate = $"{(int)difference.TotalMinutes} minutes ago";
            }
            else
            {
                // Otherwise, display it in seconds
                formattedDate = $"{(int)difference.TotalSeconds} seconds ago";
            }
        }
        else
        {
            formattedDate = "just now";
        }
        // Update the Date property with the formatted date
        item.Date = formattedDate;
        return item;
    }).ToList();
    }

    public class NewsItem
    {
        public string Title { get; set; }
        public string Link { get; set; }
        public string Date { get; set; }
        public string Image { get; set; }
    }
}
